language: java
jdk: oraclejdk8

# Define the services to use
services:
  - docker

before_install:
  - sudo service mysql stop
  - docker pull takimatraining/devops-training-db
  - docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db

# Run Unit Test and Integration Tests
script:
  - mvn verify
  - |
    mvn clean install sonar:sonar \
    -Dsonar.projectKey=<SONAR_PROJECT_KEY> \
    -Dsonar.organization=<SONAR_ORGANISATION_KEY> \
    -Dsonar.host.url=https://sonarcloud.io \
    -Dsonar.login=$SONAR_TOKEN

# Cache the .m2 folder to prevent redownloading dependencies on each build
cache:
  directories:
  - "$HOME/.m2/repository"

# Environment variables are strings (double quotes)
# Example:
# - secure: "DpR1th9rZvLMX0......"
env:
  global:
    - secure: m7w02tJFGEayuBD5YWQsJOyhOwxbDAxI5TYmUow2JOx0xF/Qopf8eY25W526MmBJxar5ccqzX3s0zReXMq+fNO4u9HuTxpgTPb3c6GkcBSpCPEUQuCAATLCOX0Z33MXJgwYJr6aHk1POqOTyUy7d/E/kMGSx3zD70EevkLn0lLom0f/p5DWfU94kST5/EbRRxMQmfWaAbHemlYSYOdZHnC/vK9FNWVSdR4CB8B83Y5pRoWFTXCYrmhIJJR0U9MxWUFf9Xuts/ZEy9FNTvuCcYZw/++81T5TFaRGoDg4Yf1uvyWgapQ3EbNsJGLQwC1MXj58wxzFZjLQ5LZANcy7/ABAonrJgMSp/QTcBkd0OtngW5WIBMK43LMdDCNWUq9Td0HAEpbdfk5nH9Yo83PNLLDYOOk8tszrnvqoZVjeQ4WQ2dUHo8ypdgzh4i093PfELGaZvIUCY4tGYixgAfC1qB5d+K3kAhuCHUdzFhJ1my5GLWVvx07RcZUngN3KpH10hDJ4hu5KxW0uW3mvFAq1obXUL1KPniIQZaqgJVlkfhrKSqEaVET375am59ZLkQ9qQfvQINGtKDzLSB9zW5nFxzw0j2KHFTzmqdDMEyN514QzLCFvkR/lClfHJyD0QDB7vdE+CfcESHOluzYqVLVF7GTLdW2MrKSa1H+fnMdw6+jE=

# Send an email to the commiter if the pipeline failed at some point
notifications:
  email:
    on_failure: always
